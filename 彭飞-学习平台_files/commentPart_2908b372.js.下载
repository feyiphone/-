/*! ablejs - v0.2.0 - Monday, March 31st, 2025, 3:10:58 PM
* http://www.ablesky.com
* Copyright (c) 2025 frontend@ablesky.com; Licensed  */
define(["jquery","common/global","workShop/study/supportPart","lib/jquery/jquery.dialog"],function(e,t,a){function i(t,a,i,n,o){var s="",r={comment:n,commentAccountId:i};if("homework"===t)s="circleIndex.do?action=saveHomeworkComment",r.homeworkId=a;else if("thesis"===t)s="circleIndex.do?action=saveThesisComment",r.thesisId=a;else{if("newsnotice"!==t)return;s="circleIndex.do?action=saveNoticeComment",r.newsNoticeId=h}var l,d="";""==n?d="请填写评论内容":n.length>200?d="最多200个字符":e.post(s,r,function(e){e.success?o():alert(e.message)},"json"),""!==d&&(l=e.dialog({title:"提示",width:300,content:'<p style="text-align: center;">'+d+"</p>",buttons:[{text:"确定",css:{backgroundColor:"#c0130d"},click:function(){l.close()}}]}))}function n(t,a,i,n,o,s){var r="",l={content:o,commentAccountId:i,commentId:n};if("homework"===t)r="circleIndex.do?action=saveHomeworkCommentResponse",l.homeworkId=a;else if("thesis"===t)r="circleIndex.do?action=saveThesisComment",l.thesisId=a;else{if("newsnotice"!==t)return;r="circleIndex.do?action=saveNoticeComment",l.newsNoticeId=h}var d,c="";""==o?c="请填写评论内容":o.length>200?c="最多200个字符":e.post(r,l,function(e){e.success?s():alert(e.message)},"json"),""!==c&&(d=e.dialog({title:"提示",width:300,content:'<p style="text-align: center;">'+c+"</p>",buttons:[{text:"确定",css:{backgroundColor:"#c0130d"},click:function(){d.close()}}]}))}function o(t,a,i){var n="",o={};if("homework"===t)n="circleIndex.do?action=deleteHomeworkComment",o.homeworkCommentId=a;else if("thesis"===t)n="circleIndex.do?action=deleteThesisComment",o.thesisCommentId=a;else{if("newsnotice"!==t)return;n="circleIndex.do?action=deleteNoticeComment",o.newsNoticeId=a}var s="确认删除该评论？",r=e.dialog({title:"提示",width:300,content:'<p style="text-align: center;">'+s+"</p>",buttons:[{text:"确定",css:{backgroundColor:"#c0130d"},click:function(){e.get(n,o,function(e){e.success?i():alert(e.message)},"json"),r.close()}},{text:"取消",click:function(){r.close()}}]})}function s(){var t=e.dialog({title:"提示",width:300,content:'<p style="text-align: center;">没有更多了</p>',buttons:[{text:"确定",css:{backgroundColor:"#c0130d"},click:function(){t.close()}}]})}function r(t,a,i,n){var o="",s={start:a,limit:i};if("homework"===t)o="circleIndex.do?action=getHomeworkCommentList",s.homeworkId=h;else if("thesis"===t)o="circleIndex.do?action=getThesisCommentList",s.thesisId=h;else{if("newsnotice"!==t)return;o="circleIndex.do?action=getNewsNoticeCommentList",s.newsNoticeId=h}e.get(o,s,function(e){var o=e.result.list;o.length>0?(d(o,t),v=a,y=i,f++):n&&n()},"json")}function l(e,t){var a=e.accountId,i=e.id,n=e.userName,o='<a href="/'+n+'" target="_blank" class="name">'+e.screenName+"</a>";e.commentAccountId&&(o+='<span style="margin-right: 10px;">回复</span><a class="name" target="_blank" href="/'+n+'">'+e.commentAccountScreenName+"</a>");var s='<a class="l-btn" data-fn="J_delBtn" data-id="'+i+'" href="javascript:;">删除</a>';e.canDelete||(s="");var r='<a class="l-btn" data-fn="J_replyBtn" comment-id="'+i+'" data-id="'+a+'" href="javascript:;">回复</a>';return"thesis"===t&&(r=""),'<div class="u-comment-item J_commentItem">            		<img class="face" src="'+e.accountPhotoUrl+'" />            		<div class="container">            			<p class="content">'+o+e.content+'</p>            			<p>            				<span class="date">'+e.postDate+"</span>            				"+r+s+'            			</p>            		</div>            		<p class="J_replyCon reply">            			<textarea class="reply-text J_replyText"></textarea>            			<a class="btn" data-fn="J_replySaveBtn" comment-id="'+i+'"  data-id="'+a+'" href="javascript:;">回复</a>            		</p>            	</div>'}function d(t,a){for(var i=t.length,n="",o=0;i>o;o++)n+=l(t[o],a);e("#commentContainer").append(n)}function c(){e("#commentContainer").html(""),f=1,v=0,y=10,r(p,v,y)}function u(t,l,d){p=t,h=l,m=d,e("#commentBtn").click(function(){var t=e("#commentContent"),a=e.trim(t.val());i(p,h,"",a,function(){t.val(""),c()})}),e("#loadMoreComment").click(function(){r(p,y,(g+1)*f,function(){s()})}),e("#commentContainer").click(function(t){var a,i=t.target,s=e(i).attr("data-fn"),r=e(i).attr("data-id"),l=e(i).attr("comment-id");"J_replyBtn"==s?e(i).parents(".J_commentItem").find(".J_replyCon").show():"J_delBtn"==s?o(p,r,function(){c()}):"J_replySaveBtn"==s&&(a=e(i).parents(".J_replyCon").find(".J_replyText"),n(p,h,r,l,a.val(),function(){a.val(""),c()}))}),r(p,0,10),a.init(p,h,m)}var p="",h="",m="",f=1,g=10,v=0,y=f*g;return{init:u}});